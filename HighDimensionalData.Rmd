---
title: "Visualizing high dimensional data"
author: "Cory Whitney, Eduardo Fernandez"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(plyr)
library(dplyr)
library(tidyverse) #tidyverse includes a number of useful packages
```

Dealing with large data sets can sometimes be confusing. If you are working in spreadsheets the confusion can reach the point of almost pure chaos. Visualization is a powerful tool that can help you to get an overview of your data. It can also help you report patterns and differences in your data. Aims objectives and hypotheses should, of course, be determined before any data is collected. 

Here we demonstrate a few different approaches for data visualization. We do this for several types of high dimensional data using a number of useful plotting functions from `ggplot2`, `plyr`, `dplyr` and `tidyverse` in the R programming language.

## Radial bar plots

For showing off options for radial bar plots we created an example data set with a factor variable using the `data.frame` and `sample` functions in base R.

```{r }
DF <- data.frame(variable = as.factor(1:10),
                 value = sample(10, replace = TRUE))
head(DF)
```

We also created a function to compute teh standard error of the mean to represent some of the uncertainty in the data using the `sqrt` and `length` functions in base R and the `var` from the `stats` library.

```{r }
se <- function(x) sqrt(var(x)/length(x)) 

```

Plot using the functions above and the `ggplot2` library.

```{r }
ggplot(DF, aes(variable, value, fill = variable)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  geom_errorbar(aes(ymin = value - se(DF$value), 
                    ymax = value + se(DF$value), 
                    color = variable), 
                width = .2) + 
  scale_y_continuous(breaks = 0:nlevels(DF$variable)) +
  theme_minimal() +
  coord_polar()
```

### Radial bar plots with a number of factor variables

Create a data set for radial plots with with three factor variables

```{r }
DF2 <- data.frame(name = rep(letters[1:3], length.out = 30),
                 variable = as.factor(1:5),
                 variable2 = rep(letters[4:7], length.out = 30),
                 value = sample(10, replace = TRUE))
head(DF2)
```

Radial plots with three factor variables

```{r }
multi_plot <- ggplot(DF2, aes(variable, value, fill = variable)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  geom_errorbar(aes(ymin = value - se(DF2$value), 
                    ymax = value + se(DF2$value), 
                    color = variable), 
                width = .2) + 
  scale_y_continuous(breaks = 0:nlevels(DF2$variable)) +
  theme_minimal() +
  coord_polar()
```

Rows as names and columns as variables `variable2`

```{r }
# Rows are name and columns are variable2
multi_plot + facet_grid(name ~ variable2)
```

Create a data for grid function with four factor variables and one continuous.

```{r }
DF3 <- data.frame(name = rep(letters[1:3], length.out = 600),
                  variable = as.factor(sample(5, replace = TRUE)),
                  variable2 = rep(letters[4:7], length.out = 600),
                  variable3 = rep(letters[8:16], length.out = 600),
                  value = sample(50, replace = TRUE))
head(DF3)
```

## Radial box plots

Radial box plot with a data set and grid with four factor variables and one continuous.

```{r }
multi_plot <- ggplot(data = DF3, aes(x=variable, y=value, fill=variable)) +
  geom_boxplot() +
  scale_y_continuous(breaks = 0:nlevels(DF3$variable)) +
  theme_minimal() +
  coord_polar()
multi_plot
```

Radial box plot with rows as names and columns as variables `variable2`

```{r }
multi_plot + facet_grid(name ~ variable2)
```

### Radial box plots example using `ToothGrowth` data 

```{r }
ToothGrowth$dose <- as.factor(ToothGrowth$dose)
DF4 <- ToothGrowth
head(DF4)
```

```{r }
box_plot <- ggplot(DF4, aes(x=dose, y=len, group=dose)) + 
  geom_boxplot(aes(fill=dose)) +
  theme_minimal()+
  coord_polar()
```

Split the radial boxplot in a vertically

```{r }
# 
box_plot + facet_grid(supp ~ .)
```

Split the radial boxplot horizontally 

```{r }
box_plot + facet_grid(. ~ supp)
```

## Sunburst plot

Create data set for a sunburst-style barplot confined to a circle

```{r }
# make some fake data
DF5 <- data.frame(
  'level1'=c('a', 'a', 'a', 'a', 'b', 'b', 'c', 'c', 'c'), 
  'level2'=c('a1', 'a2', 'a3', 'a4', 'b1', 'b2', 'c1', 'c2', 'c3'), 
  'value'=c(.025, .05, .027, .005, .012, .014, .1, .03, .18))
head(DF5)
```


Create a sunburst-style barplot confined to a circle

```{r }
ggplot(DF5, aes(y=value)) +
  geom_bar(aes(fill=level1, x=0), width=.5, stat='identity') + 
  geom_bar(aes(fill=level2, x=.25), width=.25, stat='identity') + 
  coord_polar(theta='y') + 
  theme_minimal()
```

## Spider plot

Create a function to obtain straight lines

```{r}
coord_radar <- 
  function(theta='x', start=0, direction=1){
    # input parameter sanity check
    match.arg(theta, c('x','y'))
    
    ggproto(
      NULL, CoordPolar, 
      theta=theta, r=ifelse(theta=='x','y','x'),
      start=start, direction=sign(direction),
      is_linear=function() TRUE)
  }
```

Create a new dataset and a spider plot

```{r}
factor <- c(rep("A", 16), rep("B", 16))
variable <- as.factor(c(1:16))
value <- sample(c(1:10),32,replace = T)
```

One way to close the plot is to add an "extra" level of variable which needs the same value as level 1. Both factors ("A" and "B") need this correction.

```{r}
value[16] <- value[1]
value[32] <- value[17]  
```

```{r}
data <- data.frame(factor = factor, variable = variable, value = value)
```

With `ggplot`

```{r}
ggplot(data, aes(as.numeric(data$variable),value)) + coord_radar() +
  geom_path() + scale_x_continuous(breaks = c(1:15)) +
  labs(x = "variable") + facet_wrap(.~ factor) + theme_minimal()
```

